{% extends "zato/index.html" %}

{% block html_title %}Health monitoring wizard{% endblock %}

{% block "extra_css" %}
<link rel="stylesheet" type="text/css" href="/static/zato/css/wizard.css">
{% endblock %}

{% block "extra_js" %}
<script type="text/javascript" nonce="{{ CSP_NONCE }}">
    $(document).ready(function() {
        let currentStep = 1;
        const totalSteps = 3;
        let wizardData = {};

        function updateStepper() {
            $('.step').each(function(index) {
                const stepNum = index + 1;
                $(this).removeClass('active completed');

                if (stepNum < currentStep) {
                    $(this).addClass('completed');
                } else if (stepNum === currentStep) {
                    $(this).addClass('active');
                }
            });
        }

        function showStep(step) {
            $('.wizard-step').hide();
            $('#step-' + step).show();
            updateStepper();

            if (step === 1) {
                $('#prev-button').hide();
            } else {
                $('#prev-button').show();
            }

            if (step === totalSteps) {
                $('#next-button').text('Create Dashboard');
            } else {
                $('#next-button').text('Next');
            }
        }

        $('.option-item').click(function() {
            const parent = $(this).parent();
            parent.find('.option-item').removeClass('selected');
            $(this).addClass('selected');
        });

        function goToNextStep() {
            let isValid = false;

            if (currentStep === 1) {
                const stepInput = $('#step-' + currentStep + ' input');
                if (stepInput.length && stepInput.val().trim()) {
                    wizardData['step' + currentStep] = stepInput.val().trim();
                    isValid = true;
                }
            } else {
                const selectedOption = $('#step-' + currentStep + ' .option-item.selected');
                if (selectedOption.length) {
                    wizardData['step' + currentStep] = selectedOption.data('value');
                    isValid = true;
                }
            }

            if (!isValid) {
                alert('Please make a selection');
                return;
            }

            if (currentStep < totalSteps) {
                currentStep++;
                showStep(currentStep);
                $('#next-button').blur();
            } else {
                console.log('Creating dashboard with data:', wizardData);
                alert('Dashboard creation not implemented yet');
            }
        }

        $('#next-button').click(goToNextStep);

        $('input.input-field').on('keypress', function(e) {
            if (e.which === 13) {
                goToNextStep();
            }
        });

        $('#prev-button').click(function() {
            if (currentStep > 1) {
                currentStep--;
                showStep(currentStep);
            }
        });

        showStep(1);
    });
</script>
{% endblock %}

{% block "content" %}

<div class="wizard-container">
    <div class="wizard-panel">
        <div class="wizard-layout">
            <div class="stepper">
                <h1 class="wizard-title">Is it working?</h1>
                <div class="step">
                    <div class="step-number">1</div>
                </div>
                <div class="step-connector"></div>
                <div class="step">
                    <div class="step-number">2</div>
                </div>
                <div class="step-connector"></div>
                <div class="step">
                    <div class="step-number">3</div>
                </div>
            </div>

            <div class="wizard-content">
            <div id="step-1" class="wizard-step">
                <h1 class="question-title">What do you want to monitor?</h1>
                <input type="text" class="input-field" placeholder="Enter what you want to monitor..." />
            </div>

            <div id="step-2" class="wizard-step" style="display: none;">
                <h1 class="question-title">What do you want to track?</h1>
                <div class="option-group">
                    <div class="option-item" data-value="current-status">
                        <div class="option-radio"></div>
                        <div class="option-text">Current status</div>
                    </div>
                    <div class="option-item" data-value="error-rate">
                        <div class="option-radio"></div>
                        <div class="option-text">Error rate</div>
                    </div>
                    <div class="option-item" data-value="uptime">
                        <div class="option-radio"></div>
                        <div class="option-text">Uptime</div>
                    </div>
                    <div class="option-item" data-value="activity">
                        <div class="option-radio"></div>
                        <div class="option-text">Activity</div>
                    </div>
                </div>
            </div>

            <div id="step-3" class="wizard-step" style="display: none;">
                <h1 class="question-title">How far back to look?</h1>
                <div class="option-group">
                    <div class="option-item" data-value="real-time">
                        <div class="option-radio"></div>
                        <div class="option-text">Right now</div>
                    </div>
                    <div class="option-item" data-value="last-hour">
                        <div class="option-radio"></div>
                        <div class="option-text">Last hour</div>
                    </div>
                    <div class="option-item" data-value="last-day">
                        <div class="option-radio"></div>
                        <div class="option-text">Last day</div>
                    </div>
                    <div class="option-item" data-value="last-week">
                        <div class="option-radio"></div>
                        <div class="option-text">Last week</div>
                    </div>
                    <div class="option-item" data-value="last-month">
                        <div class="option-radio"></div>
                        <div class="option-text">Last month</div>
                    </div>
                </div>
            </div>

            <div class="wizard-buttons">
                <button id="prev-button" class="wizard-button">Previous</button>
                <button id="next-button" class="wizard-button">Next</button>
            </div>
            </div>
        </div>
    </div>
</div>

{% endblock %}
